<?xml version="1.0" encoding="UTF-8"?>
<project name="Macros for (un)pack200">
	<macrodef name="repack200">
		<attribute name="jar"/>
		<sequential>
			<echo message="Repacking '@{jar}' with pack200"/>
			<exec executable="pack200" failonerror="yes">
				<arg value="--repack"/>
				<arg value="--unknown-attribute=error"/>
				<arg value="--segment-limit=-1"/>
				<arg value="--keep-file-order"/>
				<arg value="@{jar}.tmp"/>
				<arg value="@{jar}"/>
			</exec>
			<delete file="@{jar}" verbose="true" failonerror="true"/>
			<move file="@{jar}.tmp" tofile="@{jar}"/>
		</sequential>
	</macrodef>

	<macrodef name="pack200">
		<attribute name="jar"/>
		<sequential>
			<echo message="Compressing '@{jar}' to '@{jar}.pack.gz' with pack200"/>
			<exec executable="pack200" failonerror="yes">
				<arg value="--gzip"/>
				<arg value="--unknown-attribute=error"/>
				<arg value="--segment-limit=-1"/>
				<arg value="--keep-file-order"/>
				<arg value="@{jar}.pack.gz"/>
				<arg value="@{jar}"/>
			</exec>
		</sequential>
	</macrodef>

	<macrodef name="verify200">
		<attribute name="jar"/>
		<sequential>
			<echo message="Decompressing '@{jar}.pack.gz' to '@{jar}.unpacked' with unpack200"/>
			<exec executable="unpack200" failonerror="yes">
				<arg value="@{jar}.pack.gz"/>
				<arg value="@{jar}.unpacked"/>
			</exec>
			<verifyjar jar="@{jar}.unpacked"/>
			<delete file="@{jar}.unpacked" verbose="true" failonerror="true"/>
		</sequential>
	</macrodef>
</project>
